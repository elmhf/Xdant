# شرح كيفية ربط الصفحات ببعضها عبر مخزن البيانات (Data Store)

هذا الملف يشرح كيف يعمل `dataStore.js` كحلقة وصل مركزية بين صفحات **Patient** و **ToothSlice** و **Report**.

## الفكرة الأساسية: المخزن المركزي (The Central Store)
في تطبيق XDental، نستخدم مكتبة اسمها **Zustand** لإنشاء مخزن مركزي للبيانات (`src/stores/dataStore.js`). تخيل هذا المخزن كأنه "عقل" التطبيق. كل الصفحات متصلة بهذا العقل، بحيث إذا عدلت معلومة في صفحة واحدة، ترى كل الصفحات الأخرى هذا التعديل فوراً.

### كيف تتصل الصفحات ببعضها؟

#### 1. صفحة المريض (Patient Page) - البداية
*   **الدور:** هي نقطة الدخول (Input).
*   **العملية:** عندما تفتح ملف مريض، تقوم هذه الصفحة بجلب البيانات من قاعدة البيانات (Supabase) ثم تضعها داخل الـ **Store**.
*   **الكود:** تستخدم دالة مثل `loadPatientData` لملء المخزن بالمعلومات الأولية (الاسم، العمر، الأسنان، إلخ).

#### 2. صفحة الفحص والأسنان (ToothSlice Page) - التعديل
*   **الدور:** هي مكان العمل والتعديل (Processing).
*   **العملية:**
    *   تقرأ حالة الأسنان الحالية من الـ **Store**.
    *   عندما تضيف "Condition" جديد أو ملاحظة عبر الـ Dialog الذي قمنا بتعديله، فإنك لا تعدل الصفحة فقط، بل تعدل الـ **Store** مباشرة.
*   **النتيجة:** أي تعديل تفعله هنا (مثل إضافة تسوس للسن رقم 18) يتم حفظه فوراً في الـ **Store**، وبالتالي يصبح جاهزاً للعرض في التقرير.

#### 3. صفحة التقرير (Report Page) - العرض النهائي
*   **الدور:** هي المخرج (Output).
*   **العملية:** هذه الصفحة لا تحتاج أن تسأل قاعدة البيانات مرة أخرى. هي ببساطة تقرأ البيانات الجاهزة والمعدلة من الـ **Store**.
*   **الربط:** بما أن صفحة **ToothSlice** قامت بتحديث الـ **Store**، فإن صفحة **Report** ترى هذه التحديثات فوراً وتعرضها كتقرير نهائي جاهز للطباعة.

---

## ملخص التدفق (Data Flow Summary)

1.  **Patient Page** ➡️ تضع البيانات في الـ **Store**.
2.  **ToothSlice Page** ➡️ تقرأ من الـ **Store** وتعدل عليه (تضيف تشخيصات).
3.  **Report Page** ➡️ تقرأ النتيجة النهائية من الـ **Store** لتعرضها.

الرابط السحري هو: **`useDentalStore`**.
أي ملف يستدعي `useDentalStore` يصبح متصلاً بهذه الشبكة، ويرى نفس البيانات التي تراها بقية الصفحات.
